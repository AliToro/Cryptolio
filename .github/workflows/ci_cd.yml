name: scp files

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    name: Build
    runs-on: self-hosted
    steps:
    - name: test
      run: |
        cd /home/cryptolio-py-api/codes/
        pkill -f "/home/cryptolio-py-api/codes/bin/uvicorn main:app --reload" || true
        git pull
        source bin/activate
        nohup uvicorn main:app --reload --host ${{ secrets.HOST }} >/home/cryptolio-py-api/codes/logs/run.log 2>&1 &
